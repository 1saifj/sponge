## sponge [中文](assets/readme-cn.md)

<p align="center">
<img align="center" width="500px" src="https://raw.githubusercontent.com/zhufuyi/sponge/main/assets/logo.png">
</p>

<div align=center>

[![Go Report](https://goreportcard.com/badge/github.com/zhufuyi/sponge)](https://goreportcard.com/report/github.com/zhufuyi/sponge)
[![codecov](https://codecov.io/gh/zhufuyi/sponge/branch/main/graph/badge.svg)](https://codecov.io/gh/zhufuyi/sponge)
[![Go Reference](https://pkg.go.dev/badge/github.com/zhufuyi/sponge.svg)](https://pkg.go.dev/github.com/zhufuyi/sponge)
[![Go](https://github.com/zhufuyi/sponge/workflows/Go/badge.svg?branch=main)](https://github.com/zhufuyi/sponge/actions)
[![License: MIT](https://img.shields.io/github/license/zhufuyi/sponge)](https://img.shields.io/github/license/zhufuyi/sponge)
[![Join the chat at https://gitter.im/zhufuyi/sponge](https://badges.gitter.im/Join%20Chat.svg)](https://gitter.im/zhufuyi/sponge?utm_source=badge&utm_medium=badge&utm_campaign=pr-badge&utm_content=badge)

</div>

[sponge](https://github.com/zhufuyi/sponge) is a microservice framework, a tool to quickly generate web and microservice code. sponge has a rich generating code commands, a total of 12 different functional code, these functional code can be combined into a complete service (similar to artificially broken sponge cells can be automatically reorganized into a new sponge). Microservice code features include logging, service registration and discovery, registry, rate limiter, circuit breaker, trace, metrics monitoring, pprof performance analysis, statistics, caching, CICD. The code uses a decoupled layered structure and it's easy to add or replace functional code. As an efficiency-enhancing tool, commonly repeated code is basically generated automatically and only business logic code needs to be populated based on the generated template code examples.

<br>

### sponge command framework

The generated code is based on three approaches **Yaml**, **SQL DDL** and **Protocol buffers**, each possessing different functional code generation, and the framework diagram of the generated code is shown in Figure 1-1.

<p align="center">
<img align="center" width="1500px" src="https://raw.githubusercontent.com/zhufuyi/sponge/main/assets/sponge-framework.png">
</p>

*Figure 1-1 spong generation code framework diagram*

<br>

- **Yaml** generates configuration files corresponding to go struct code.
- **SQL DDL** generated code includes http, handler, dao, model, proto, rpc, service, divided into two types of web and rpc, web and rpc types have their own sub-modules, each module code can be generated separately, between the modules like an onion layer of independent decoupling. The code includes standardized CRUD (add, delete, change, check) business logic, which can be directly compiled and used.
  - **web type code**: Generate http service code including handler, dao, model three sub-module code, as shown in the diagram inward contain, the same principle, generate handler module code contains dao, model two sub-module code.
  - **rpc type code**: generate rpc service code including service, dao, model, protocol buffers four sub-modules, as shown in the diagram inwards contain, generate service module code including dao, model, protocol buffers three sub-module code.
- The code generated by **Protocol buffers** includes http-pb, rpc-pb, rpc-gw-pb, also divided into web and rpc types, where http-pb, rpc-pb are usually used in combination with dao, model code generated by **SQL DDL**.
  - **http-pb**: http service code includes two sub-modules, router and handler template, excluding the operation database sub-module, and subsequent business logic code is filled to the handler template file.
  - **rpc-pb**: rpc service code includes service template a sub-module, not including the operation database module, subsequent business logic code filled to the service template file.
  - **rpc-gw-pb**: rpc gateway is actually an http service, including two submodules, router and service template, where the service template code is the business logic code related to calling the rpc service.

In the same folder, if the latest generated code is found to conflict with the original code, sponge will cancel the generation process and will not make any changes to the original code, so you don't have to worry about writing business logic code that is overwritten.

<br>

### Microservices framework

The microservice code framework created by sponge is shown in Figure 1-2, which is a typical microservice hierarchy containing common service governance functions.

<p align="center">
<img align="center" width="1500px" src="https://raw.githubusercontent.com/zhufuyi/sponge/main/assets/microservices-framework.png">
</p>

*Figure 1-2 Microservices framework diagram*

<br>

Microservices main functions:

- Web framework [gin](https://github.com/gin-gonic/gin)
- RPC framework [grpc](https://github.com/grpc/grpc-go)
- Configuration file parsing [viper](https://github.com/spf13/viper)
- Configuration Center [nacos](https://github.com/alibaba/nacos)
- Logging [zap](https://go.uber.org/zap)
- Database component [gorm](https://gorm.io/gorm)
- Caching component [go-redis](https://github.com/go-redis/redis) [ristretto](github.com/dgraph-io/ristretto)
- Documentation [swagger](https://github.com/swaggo/swag)
- Authorization [jwt](https://github.com/golang-jwt/jwt)
- Validator [validator](https://github.com/go-playground/validator)
- Rate limiter [ratelimit](pkg/shield/ratelimit)
- Circuit Breaker [circuitbreaker](pkg/shield/circuitbreaker)
- Tracing [opentelemetry](https://go.opentelemetry.io/otel)
- Monitoring [prometheus](https://github.com/prometheus/client_golang/prometheus), [grafana](https://github.com/grafana/grafana)
- Statistics [gopsutil](https://github.com/shirou/gopsutil)
- Service registry and discovery [etcd](https://github.com/etcd-io/etcd), [consul](https://github.com/hashicorp/consul), [nacos](https://github.com/alibaba/)
- Performance analysis [go profile](https://go.dev/blog/pprof)
- Code inspection [golangci-lint](https://github.com/golangci/golangci-lint)
- Continuous Integration CI [jenkins](https://github.com/jenkinsci/jenkins)
- Continuous Deployment CD [docker](https://www.docker.com/), [kubernetes](https://github.com/kubernetes/kubernetes)

<br>

The code directory structure follows [project-layout](https://github.com/golang-standards/project-layout), and the code directory structure is shown below.

```bash
.
├── api               # proto files and the generated *pb.go directory
├── assets            # Directory of other assets used with the repository (images, logos, etc.)
├── build             # Package and continuous integration directory
├── cmd               # Program entry directory
├── configs           # Directory for configuration files
├── deployments       # Configuration and template directories for IaaS, PaaS, system and container orchestrated deployments
├─ docs               # Design documentation and interface documentation directory
├── internal          # The code directory for private applications and libraries
│ ├── cache           # business wrapper based cache directory
│ ├── config          # The configuration file directory for the Go structure
│ ├── dao             # Data access directory
│ ├── ecode           # Custom business error code directory
│ ├── handler         # http's business function implementation directory
│ ├── model           # Database model directory
│ ├── routers         # http routing directory
│ ├── rpcclient       # The client directory to connect to the rpc service
│ ├── server          # Service entry, including http, rpc, etc.
│ ├── service         # rpc's business function implementation directory
│ └── types           # Directory of request and response types for http
├── pkg               # The directory of libraries that external applications can use
├── scripts           # A directory of scripts for performing various build, installation, analysis, etc. operations
├── test              # Additional external test procedures and test data
└── third_party       # External helpers, forked code, and other third-party tools
```

The web service and rpc service directory structures are basically the same, with some directories unique to the web service (routers, handlers, types in the internal directory) and some directories unique to the rpc service (services in the internal directory).

<br>

### Documentation

- [2 Installation](assets/install-sponge.md)
- [3 Quickly create web projects](assets/create-web-project.md)
- [4 Quickly create microservices projects](assets/create-micro-project.md)
- [5 Service governance introduction](assets/service-governance.md)
- [6 Continuous Integration And Continuous Deployment](assets/cicd.md)

If it's useful to you, give it a star ⭐.

<br>

## License

See the [LICENSE](LICENSE) file for licensing information.
